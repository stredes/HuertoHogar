<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Productos | HuertoHogar</title>

  <!-- Bootstrap 5.3.8 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

  <!-- Estilos propios -->
  <link rel="stylesheet" href="../css/styles.css" />
</head>
<body class="bg-light">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold text-success" href="../index.html">ðŸ¥‘ HuertoHogar</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
        aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="../index.html">Inicio</a></li>
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="productos.html">Productos</a></li>
          <li class="nav-item"><a class="nav-link" href="nosotros.html">Nosotros</a></li>
          <li class="nav-item"><a class="nav-link" href="blog.html">Blog</a></li>
          <li class="nav-item"><a class="nav-link" href="contacto.html">Contacto</a></li>
          <li class="nav-item"><a class="nav-link" href="login.html">Iniciar sesiÃ³n</a></li>
          <li class="nav-item"><a class="btn btn-outline-success ms-2" href="carrito.html">ðŸ›’ Carrito</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header de pÃ¡gina -->
  <header class="bg-white border-bottom">
    <div class="container py-4">
      <h1 class="h3 text-success fw-bold mb-0">CatÃ¡logo de productos</h1>
      <p class="text-muted mb-0">Explora nuestras frutas, verduras y productos orgÃ¡nicos.</p>
    </div>
  </header>

  <main class="container my-4">
    <!-- Filtros -->
    <form class="row g-3 align-items-end mb-3" id="form-filtros">
      <div class="col-12 col-md-6">
        <label for="q" class="form-label">Buscar</label>
        <input id="q" type="search" class="form-control" placeholder="Ej: manzana, miel, lecheâ€¦">
      </div>
      <div class="col-6 col-md-3">
        <label for="categoria" class="form-label">CategorÃ­a</label>
        <select id="categoria" class="form-select">
          <option value="">Todas</option>
          <option value="Frutas Frescas">Frutas Frescas</option>
          <option value="Verduras OrgÃ¡nicas">Verduras OrgÃ¡nicas</option>
          <option value="Productos OrgÃ¡nicos">Productos OrgÃ¡nicos</option>
          <option value="Productos LÃ¡cteos">Productos LÃ¡cteos</option>
        </select>
      </div>
      <div class="col-6 col-md-3">
        <label for="orden" class="form-label">Ordenar por</label>
        <select id="orden" class="form-select">
          <option value="">Relevancia</option>
          <option value="precio_asc">Precio: menor a mayor</option>
          <option value="precio_desc">Precio: mayor a menor</option>
          <option value="nombre_asc">Nombre Aâ€“Z</option>
          <option value="nombre_desc">Nombre Zâ€“A</option>
        </select>
      </div>
    </form>

    <!-- Grid -->
    <div id="grid" class="row g-4">
      <!-- Tarjetas generadas con JS -->
    </div>

    <!-- Estado -->
    <div id="estado" class="text-muted mt-3" hidden>Sin resultadosâ€¦</div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-top py-4 mt-5">
    <div class="container d-flex justify-content-between flex-wrap">
      <small>Â© <span id="year"></span> HuertoHogar.</small>
      <div>
        <a href="#" class="text-muted me-3">Privacidad</a>
        <a href="#" class="text-muted me-3">TÃ©rminos</a>
        <a href="#" class="text-muted">Accesibilidad</a>
      </div>
    </div>
  </footer>

  <!-- JS app compartido -->
  <script src="../js/main.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

  <!-- Script de pÃ¡gina: render catÃ¡logo y filtros -->
  <script>
    // Mapeo simple de categorÃ­as por cÃ³digo
    const MAP_CATEGORIA = {
      FR: "Frutas Frescas",
      VR: "Verduras OrgÃ¡nicas",
      PO: "Productos OrgÃ¡nicos",
      PL: "Productos LÃ¡cteos",
    };

    function categoriaDe(code) {
      // Toma los dos primeros caracteres del cÃ³digo (FR, VR, PO, PL)
      const pref = (code || "").slice(0,2);
      return MAP_CATEGORIA[pref] || "";
    }

    function filtroProductos(lista) {
      const q = document.getElementById('q').value.trim().toLowerCase();
      const cat = document.getElementById('categoria').value;
      let res = [...lista];

      if (q) {
        res = res.filter(p =>
          p.nombre.toLowerCase().includes(q) ||
          String(p.code).toLowerCase().includes(q)
        );
      }
      if (cat) {
        res = res.filter(p => categoriaDe(p.code) === cat);
      }
      const ord = document.getElementById('orden').value;
      if (ord === 'precio_asc') res.sort((a,b)=>a.precio-b.precio);
      if (ord === 'precio_desc') res.sort((a,b)=>b.precio-a.precio);
      if (ord === 'nombre_asc') res.sort((a,b)=>a.nombre.localeCompare(b.nombre));
      if (ord === 'nombre_desc') res.sort((a,b)=>b.nombre.localeCompare(a.nombre));

      return res;
    }

    function renderCatalogo() {
      const cont = document.getElementById('grid');
      const estado = document.getElementById('estado');
      cont.innerHTML = '';

      const lista = filtroProductos(window.PRODUCTOS || []);
      if (lista.length === 0) {
        estado.hidden = false;
        return;
      }
      estado.hidden = true;

      for (const p of lista) {
        const col = document.createElement('div');
        col.className = "col-12 col-sm-6 col-lg-4";

        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <img src="${p.img}" class="card-img-top" alt="${p.nombre}" loading="lazy">
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="badge bg-secondary">${categoriaDe(p.code)}</span>
                <span class="badge bg-warning text-dark">${p.code}</span>
              </div>
              <h5 class="card-title">${p.nombre}</h5>
              <p class="card-text text-muted mb-1">${formatPrecio(p.precio)} / ${p.unidad}</p>
              <p class="card-text"><small class="text-body-secondary">Stock: ${p.stock}</small></p>
              <div class="mt-auto d-flex gap-2">
                <a class="btn btn-outline-success w-50" href="producto_detalle.html?code=${encodeURIComponent(p.code)}">Ver</a>
                <button class="btn btn-success w-50" data-code="${p.code}">AÃ±adir</button>
              </div>
            </div>
          </div>
        `;
        // acciÃ³n aÃ±adir
        col.querySelector('button[data-code]').addEventListener('click', (e)=>{
          addToCart(e.currentTarget.getAttribute('data-code'), 1);
        });

        cont.appendChild(col);
      }
    }

    // Eventos de filtros
    document.getElementById('q').addEventListener('input', renderCatalogo);
    document.getElementById('categoria').addEventListener('change', renderCatalogo);
    document.getElementById('orden').addEventListener('change', renderCatalogo);

    // AÃ±o en footer + primer render
    document.getElementById('year').textContent = new Date().getFullYear();
    document.addEventListener('DOMContentLoaded', () => {
      renderCatalogo();
      updateCartBadge();
    });
  </script>
</body>
</html>
